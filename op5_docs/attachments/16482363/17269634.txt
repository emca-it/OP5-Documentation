How
------------------
1. Fully update/upgrade OP5 System 2.8 and your products before attempting
   OP5 System 3.0 upgrade. Latest software-versions (upgrades) before System 3.0
   are:
	op5 System 2.8
	op5 Monitor 3.0
	op5 Statistics 2.10
	op5 LogServer 1.4
2. Download the media
3. Download the prepare-script
4. Backup your system (complete backup)
5. Backup data with the prepare-script
7. Extra information for LogServer-upgrades
8. Completely overwrite system and products:
   install new system
   install the products
9. Restore the backed up data and settings
10. Install your license key
11. Fully update your system


Download the media
------------------
System:
https://www-dup.op5.com/products/system/3.0/op5-System-install-3.0.6.iso

Monitor:
https://www-dup.op5.com/products/monitor/3.2/op5-monitor-install-3.2.4.tar.gz

Statistics:
https://www-dup.op5.com/products/statistics/2.10/op5-statistics-install-2.10.4.tar.gz

LogServer:
https://www-dup.op5.com/products/logserver/2.0/op5-logserver-install-2.0.1.tar.gz

_about ISO-files_
The iso-files are, except for the bootable System install image, provided for
easy media creation only, they contain the same zip-file (.tar.gz) which can be
downloaded separately.

_about TAR-files_
op5 software is distributed via gzip-compressed tar-balls (tape archives). Since
you can easily extract these archives on your OP5 System, there is no need to
uncompress (extract) the content of these archives before transferring (or
downloading) the files to your server.


Download the prepare-script
------------------
https://www-dup.op5.com/products/system/3.0/op5-system-upgrade-3.0.0/prepare-system-upgrade-3.0.0.sh

Transfer the file to your op5-server and set execute-permissions:
[root@op5-system ~] chmod a+x prepare-system-upgrade-3.0.0.sh


Backup your system
------------------
First start with taking a backup of your system. This is the most important step
in the upgrade. Without a backup you will NOT be able to reverse the
upgrade process and we will NOT be able to help you recover lost information.

Do the backup using this commands, be sure that you are logged into your
OP5 System as user root.

cd /
tar zcf op5-System-backup.tar.gz bin boot dev etc home lib mnt opt root sbin usr
var

If you want to exclude a LogServers archive (the loadfiles) (can be ALOT of
data) use the following commands instead:
cd /
tar zcf op5-System-backup.tar.gz bin boot dev etc home lib mnt opt root sbin
usr var --exclude=lf.*-*.bz2

This will take some time and create a large file 'OP5-System-backup.tar.gz'

Copy this file to another computer. You can do this using ftp or scp.

NOTE: The tar command might produce two kind of error messages that safely 
can be ignored.
1, Every 'socket ignored' error mesage is irrelevant. 
2, 'File changed as we read it' regarding log files is ok and can be
overlooked. 
If you have any of the error messages mentioned above you will get the following
message when the backup is finished.
'tar: Error exit delayed from previous errors'
Assued that you only have the error messages mentioned above this message is
also safe to ignore.
3, If you have some kind of customization made to your system, please back up
the apropriate files/folders separately.


Backup data and settings with the prepare-script
------------------
execute the script, follow the on-screen-instructions and make sure that you
succeed in creating and moving your backup-file TO ANOTHER FILESYSTEM (other
server or media)
[root@op5-system ~]./prepare-system-upgrade-3.0.0.sh


Extra information for LogServer-upgrades:
------------------
When upgrading a LogServer the following settings and data will be included in
the backup made by the prepare-script:
filters
users
user-settings
admin-settings

The following data will NOT be included in the backup made by the
prepare-script:
messages currently in database
messages archived at local storage path

Since the system upgrade will completely overwrite the local filesystem, only
messages stored in remote filesystems, will be available for import after the
upgrade.

If you already have a remote storage path configured (some other path than the
local storage path set), you are probably using remote storage. If thats the
case, just check that this path is a mounted remote filesystem and that you have
a current archive at that location.

If you don't have an remote storage path configured (same path as the local
storage path set), and want to be able to import previously archived messages
after the system upgrade, you'll need to recursively copy the log-archive at
local storage path to another filesystem and mount that folder in the filesystem
after upgrade. The remote storage path should then be set to this new
mountpoint.


Completely overwrite system and products:
------------------
_Install new system_
Burn an install-CD from the downloaded .iso-file
Insert the CD into your op5-server
Reboot the server (with the 'reboot'-command)
type 'install' and press enter
The system-installation-process will take several minutes -get some coffe
The system-installation-process is done when you see the on-screen-instruction
telling you to remove the installation media and press the reboot button
After reboot you'll have a clean OP5 System installation (Operating system)
without any running configuration.
At startup you can setup basic system configuration. This is however not needed
if you're upgrading, since these settings are in the backup made by the
prepare-script.

_Install the products_
Login as 'root' with password 'monitor' at the console or via ssh (your op5
System defaults to get it's IP-address from DHCP, so if you have one, the server
is reachable via ssh)
Extract the product archive in root's homedirectory ('/root' or '~'), see
example:
[root@op5-system ~]# tar xvzf op5-monitor-install-3.2.3.tar.gz
Change directory and run the installscript, see examples:
op5 Monitor:
[root@op5-system ~]# cd monitor-3.2.3/
[root@op5-system monitor-3.2.0]# ./install.sh
op5 Statistics:
[root@op5-system ~]# cd statistics-2.10.4/
[root@op5-system statistics-2.10.4]# ./install.sh


Restore the backed up data and settings
------------------
Execute the restore-script, see example:
[root@op5-system ~]# restore-System-Upgrade-Backup.sh
Follow the on-screen-instruction to retieve and restore the backup.
Reboot the server with command 'reboot'
After reboot the server should be available via https and ssh at it's previously
configured IP-adress.


Install your license key
------------------
If you have a current service&support-agreement you can request a license via 
e-mail from support@op5.se. (A license request form will soon be published on 
support.op5.com)

To install the license, tranfer the file to your server and install it using the 
terminal command 'op5license-install', se example below:

[root@testserver ~]# op5license-install my_organisation.xml


Fully update your system
------------------
With the license-key installaed you can initialize an update-process with the 
command "yum update". To install the packages that are listed, answer Yes to the 
prompted question.

